# Adapted by Thibault PIANA & Alan Gardin
# Creation : 20/10/2015

# Makefiles Definitions

LIB_GCC=${LIB_PATH}/lib/gcc/arm-none-eabi/4.3.3/
LIB_C=${LIB_PATH}/arm-none-eabi/lib/

# Source code paths
BOOT_SRC=${ROOT}/boot/
ARCH_SRC=${ROOT}/arch/
DRIVER_SRC=${ROOT}/drivers/
KERNEL_SRC=${ROOT}/kernel/

# Include paths
IPATH=-I${ROOT}/include/arch/arm/ \
      -I${ROOT}/include/arch/arm/hal \
      -I${ROOT}/include/arch/arm/hal/hw \
      -I"${LIB_PATH}/include"

# Library paths
LPATH=-L"${LIB_C}" \
      -L"${LIB_GCC}" \
      -L${HAL_BIN}/${TARGET_MODE} \


# C compilation options
Debug_FLAG=-g
Release_FLAG=-g -O2

ifdef DEVICE
    DEVICE_D=-D${DEVICE}
endif

ifdef EVM
    EVM_D=-D${EVM}
endif

#CFLAGS=-mcpu=cortex-a8
#CFLAGS+=-c ${${TARGET_MODE}_FLAG} -mlong-calls -fdata-sections -funsigned-char -ffunction-sections -Wall ${IPATH} -Dgcc ${DEVICE_D} ${EVM_D} -D SUPPORT_UNALIGNED -D ${BOOT}
#CFLAGS = -c -mlong-calls -fdata-sections -funsigned-char -ffunction-sections -Wall ${IPATH} -Dgcc ${DEVICE_D} ${EVM_D} -D SUPPORT_UNALIGNED -D ${BOOT}

# Flags pour la compilation des .c en .o
CFLAGS = -Wall ${IPATH} -nostdlib -nostartfiles -ffreestanding -Dam335x -march=armv7-a -mtune=cortex-a8 -mcpu=cortex-a8

# Defining the cross compiler tool prefix
ifndef PREFIX
#    PREFIX=arm-none-eabi
    PREFIX=arm-linux-gnueabihf
endif

# Compiler, Linker and Archiver with respect to the toolchain
CC=${PREFIX}-gcc
LD=${PREFIX}-ld
AR=${PREFIX}-ar
BIN=$(PREFIX)-objcopy
AS=${PREFIX}-as

# Archiver options
ARFLAGS=-c -r

# Linker options
LDFLAGS=-e Entry -u Entry -u __aeabi_uidiv -u __aeabi_idiv --gc-sections

# arm-none-eabi-gcc -c -g -mcpu=cortex-a8 -mlong-calls -fdata-sections -funsigned-char -ffunction-sections -Wall -Dgcc -Dam335x -D SUPPORT_UNALIGNED -D MMCSD -g main.c